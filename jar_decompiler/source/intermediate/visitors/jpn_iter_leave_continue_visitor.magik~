_package deco
$

#remex(:jpn_iter_result_hider_visitor)

_pragma(classify_level=restricted, topic={jar_decompiler})
def_slotted_exemplar(:jpn_iter_result_hider_visitor,
	{})
$

_pragma(classify_level=restricted, topic={jar_decompiler})
_method jpn_iter_result_hider_visitor.new()
	>> _clone.init()
_endmethod
$

_pragma(classify_level=restricted, topic={jar_decompiler})
_private _method jpn_iter_result_hider_visitor.init()
	>> _self 
_endmethod
$

_pragma(classify_level=restricted, topic={jar_decompiler})
_method jpn_iter_result_hider_visitor.accept(p_body)
	##
	_local sts << p_body.statements
	_for i_index, i_node _over sts.fast_keys_and_elements()
	_loop
		_if _self.should_clear_unset_results?(i_node)
		_then
			_self.clear_unset_results(i_node.expression.body)
		_endif
	_endloop 
_endmethod
$

_pragma(classify_level=restricted, topic={jar_decompiler})
_method jpn_iter_result_hider_visitor.clear_unset_results(p_body)
	_local sts << p_body.statements
	
	_for i_index, i_node _over sts.fast_keys_and_elements()
	_loop
		_if _self.is_result_tuple?(i_node)
		_then
			sts[i_index] << dcn_no_op.new()
		_endif 
	_endloop 
_endmethod
$

_pragma(classify_level=restricted, topic={jar_decompiler})
_method jpn_iter_result_hider_visitor.is_result_tuple?(p_node)
	##
	_if p_node.is_class_of?(dcn_local_declaration)
	_then
		_return p_node.name = "resultTuple"
	_elif p_node.is_class_of?(dcn_local_assignment) _andif
	      p_node.only_local() _isnt _unset 
	_then
		_return p_node.only_local().name = "resultTuple"
	_elif p_node.is_class_of?(dcn_continue) _andif
	      p_node.results.size = 1
	_then
		_return p_node.results[1].name = "resultTuple"
	_else
		_return _false 
	_endif 
_endmethod
$


_pragma(classify_level=restricted, topic={jar_decompiler})
_method jpn_iter_result_hider_visitor.should_clear_unset_results?(p_node)
	##
	_if p_node.is_class_of?(dcn_local_assignment).not _then _return _false, :no_local_assignment _endif
	_if p_node.expression.is_class_of?(dcn_iter).not _then _return _false, :no_iter _endif

	_local loc << p_node.only_local()
	_if loc _is _unset _then _return _false, :no_only_local  _endif
	_if loc.name.matches?("*ignored*").not _then _return _false, :no_ignore _endif
	
	_return _true 
_endmethod
$
